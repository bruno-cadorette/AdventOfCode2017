module Main where
import Data.Char
import Control.Applicative
import Data.List
import Data.Maybe
import qualified Data.Map as Map

day1Input = fmap digitToInt "428122498997587283996116951397957933569136949848379417125362532269869461185743113733992331379856446362482129646556286611543756564275715359874924898113424472782974789464348626278532936228881786273586278886575828239366794429223317476722337424399239986153675275924113322561873814364451339186918813451685263192891627186769818128715595715444565444581514677521874935942913547121751851631373316122491471564697731298951989511917272684335463436218283261962158671266625299188764589814518793576375629163896349665312991285776595142146261792244475721782941364787968924537841698538288459355159783985638187254653851864874544584878999193242641611859756728634623853475638478923744471563845635468173824196684361934269459459124269196811512927442662761563824323621758785866391424778683599179447845595931928589255935953295111937431266815352781399967295389339626178664148415561175386725992469782888757942558362117938629369129439717427474416851628121191639355646394276451847131182652486561415942815818785884559193483878139351841633366398788657844396925423217662517356486193821341454889283266691224778723833397914224396722559593959125317175899594685524852419495793389481831354787287452367145661829287518771631939314683137722493531318181315216342994141683484111969476952946378314883421677952397588613562958741328987734565492378977396431481215983656814486518865642645612413945129485464979535991675776338786758997128124651311153182816188924935186361813797251997643992686294724699281969473142721116432968216434977684138184481963845141486793996476793954226225885432422654394439882842163295458549755137247614338991879966665925466545111899714943716571113326479432925939227996799951279485722836754457737668191845914566732285928453781818792236447816127492445993945894435692799839217467253986218213131249786833333936332257795191937942688668182629489191693154184177398186462481316834678733713614889439352976144726162214648922159719979143735815478633912633185334529484779322818611438194522292278787653763328944421516569181178517915745625295158611636365253948455727653672922299582352766484"



solve n xs = sum $ zipWith (\a b -> if a == b then a else 0) xs (drop n $ cycle xs)
solve1 = solve 1
solve2 xs = solve ((length xs) `div` 2) xs

parseDay2 :: String -> [[Int]]
parseDay2 = fmap (fmap read . words) . lines

solveDay2p1 :: [[Int]] -> Int
solveDay2p1 = sum . fmap (\ys -> maximum ys - minimum ys)

solveDay2p2 :: [[Int]] -> Maybe Int
solveDay2p2 =  fmap sum . traverse sp2
    where
        sp2 xs = fmap (\(a,b) -> max a b `div` min a b) $ listToMaybe $ filter (\(a,b) -> a `mod` b == 0 && a /= b) $ liftA2 (,) xs xs
 

up    (a, b) = (a, b + 1)
down  (a, b) = (a, b - 1)
left  (a, b) = (a - 1, b)
right (a, b) = (a + 1, b)
directions = [right, up, left, down]

day3Gen = scanl (\c f -> f c) (0,0) $ concat $ zipWith replicate steps (cycle directions)
    where
        steps = concat $ zipWith (\a b -> [a,b]) [1..] [1..]
getValue :: Num a => (Integer, Integer) -> Map.Map (Integer, Integer) a -> a
getValue position table = sum $ mapMaybe (\f -> Map.lookup (f position) table) dir
    where 
        dir = directions ++ [\(a,b) -> (a + 1, b + 1), \(a,b) -> (a - 1, b + 1), \(a,b) -> (a + 1, b - 1), \(a,b) -> (a - 1, b - 1)]

setValue table coord = 
    let x = getValue coord table
    in (Map.insert coord x table, x)

day3Part1 = day3Gen !! 361526
day3Part2 = find (> 361527) $ snd $ mapAccumL setValue (Map.singleton (0,0) 1) $ drop 1 day3Gen

main :: IO ()
main = do 
    print (day3Gen !! 361526)
    {-let xs = day1Input
    print $ solve1 xs
    print $ solve2 xs
    day2 <- parseDay2 <$> readFile "day2.txt"
    print (solveDay2p1 day2)
    print (solveDay2p2 day2)-}